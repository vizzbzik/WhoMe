
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ APP }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>{{ APP }}</h1>
        {% if me %}
            <p>–ü—Ä–∏–≤–µ—Ç, {{ me.first_name }} {{ me.last_name }}{% if me.is_admin %} <a href="/admin/users">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>{% endif %}
              <header class="topbar">
  <nav>
    <a href="/">–õ–µ–Ω—Ç–∞</a>
    <a href="/channels">–ì—Ä—É–ø–ø—ã</a>
    <a href="/chats">–ß–∞—Ç—ã</a>
    {% if me %}
      <a href="/profile/{{ me.username }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
    {% else %}
      <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      <a href="/login">–í—Ö–æ–¥</a>
    {% endif %}
                </nav>
</header>
              <a href="/logout">–í—ã–π—Ç–∏</a></p>
              <button id="theme-toggle">üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞</button>
        {% else %}
            <p><a href="/login">–í–æ–π—Ç–∏</a> | <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></p>
        {% endif %}
    </header>
    <script>
const toggleButton = document.getElementById("theme-toggle");
const body = document.body;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è —Ç–µ–º–∞ –≤ localStorage
if (localStorage.getItem("theme") === "dark") {
    body.classList.add("dark-theme");
    toggleButton.textContent = "‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞";
}

toggleButton.addEventListener("click", () => {
    body.classList.toggle("dark-theme");
    if (body.classList.contains("dark-theme")) {
        toggleButton.textContent = "‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞";
        localStorage.setItem("theme", "dark");
    } else {
        toggleButton.textContent = "üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞";
        localStorage.setItem("theme", "light");
    }
});
</script>


    {% if me %}
    <section>
        <h2>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h2>
    <form action="/post" method="post" enctype="multipart/form-data">
            <textarea name="content" placeholder="–ò–¥—É –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–µ –≤ –≥–æ–ª–æ–≤–µ –ª—è-–ª—è-–ª—è" required></textarea><br>
        <input type="file" name="image"><br>
        <button type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                        </form>
                </section>
    {% endif %}

    <hr>

    <section>
    <h2>–ü–æ—Å—Ç—ã</h2>
    {% for post in posts %}
        <div id="post-{{ post.id }}" style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
            <p><strong>{{ post.username }}</strong> ({{ post.first_name }} {{ post.last_name }})
            {% if post.is_verified %}‚úîÔ∏è{% endif %}</p>

            {% if post.avatar %}
                <img src="/{{ post.avatar }}" alt="Avatar" width="50">
            {% endif %}

            <p>{{ post.content }}</p>
            {% if post.image %}
                <img src="/{{ post.image }}" alt="Post image" style="max-width:300px;">
            {% endif %}
            
           <!-- –õ–∞–π–∫–∏ -->
<button class="like-btn {% if post.is_liked %}liked{% endif %}" data-post-id="{{ post.id }}">‚ù§Ô∏è</button>
<span class="like-count">{{ post.like_count or 0 }}</span>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const likeButtons = document.querySelectorAll(".like-btn");

    likeButtons.forEach(button => {
        button.addEventListener("click", async () => {
            const postId = button.dataset.postId;

            const response = await fetch(`/like/${postId}`, {
                method: "POST"
            });

            if (response.ok) {
                const data = await response.json();
                const likeCountSpan = button.nextElementSibling;

                likeCountSpan.textContent = data.count;

                if (data.status === "liked") {
                    button.classList.add("liked");
                } else {
                    button.classList.remove("liked");
                }
            } else {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ª–∞–π–∫–µ –ø–æ—Å—Ç–∞");
            }
        });
    });
});
</script>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            <div class="comments">
                <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h4>
                {% for comment in post.comments %}
                    <p><b>{{ comment.username }}</b>: {{ comment.content }}</p>
                {% else %}
                    <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                {% endfor %}

                {% if me %}
                <form action="/post/{{ post.id }}/comment" method="post">
                    <textarea name="content" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea><br>
                    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
                {% endif %}
            </div>

            {% if me and (me.id == post.user_id or me.is_admin) %}
                <br><form action="/post/{{ post.id }}/delete" method="post" style="display:inline;">
                    <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            {% endif %}
        </div>
    {% else %}
        <p>–ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endfor %}
</section>
</script>
</body>
</html>